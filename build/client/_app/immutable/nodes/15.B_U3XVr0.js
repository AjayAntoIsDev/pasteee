import{_ as F}from"../chunks/11.BObqaQEo.js";import{s as Y,e as w,a as L,t as B,c as k,b as D,m as J,g as U,d as H,f as v,o as i,i as W,h as m,p as V,n as q,v as X,k as G,w as Q,B as Z,z as R,j as $}from"../chunks/scheduler.VK6vfmC_.js";import{S as tt,i as et}from"../chunks/index.BycGP4sO.js";import{g as K}from"../chunks/entry.BtI8Upk3.js";import{p as st}from"../chunks/stores.Dawflz9q.js";import{encrypt as at,encryptWithPassword as rt}from"../chunks/crypto.VCyhLLHW.js";function nt(r){let t,e,a;return{c(){t=w("textarea"),this.h()},l(s){t=k(s,"TEXTAREA",{class:!0,spellcheck:!0}),D(t).forEach(v),this.h()},h(){i(t,"class","px-2 grow border-none outline-none bg-transparent resize-none"),i(t,"spellcheck","false")},m(s,g){W(s,t,g),R(t,r[0]),e||(a=V(t,"input",r[14]),e=!0)},p(s,g){g&1&&R(t,s[0])},d(s){s&&v(t),e=!1,a()}}}function lt(r){let t,e,a,s,g="Decrypt",c,p;return{c(){t=w("div"),e=w("input"),a=L(),s=w("button"),s.textContent=g,this.h()},l(_){t=k(_,"DIV",{class:!0});var u=D(t);e=k(u,"INPUT",{class:!0,type:!0,placeholder:!0}),a=U(u),s=k(u,"BUTTON",{class:!0,"data-svelte-h":!0}),J(s)!=="svelte-one9lr"&&(s.textContent=g),u.forEach(v),this.h()},h(){i(e,"class","md:w-1/3 text-lg px-4 py-1 bg-dark text-white"),i(e,"type","text"),i(e,"placeholder","Enter password..."),i(s,"class","md:w-fit bg-amber-500 text-black text-lg px-4 py-1"),i(t,"class","flex flex-col items-center gap-4 md:mt-10")},m(_,u){W(_,t,u),m(t,e),r[12](e),R(e,r[1]),m(t,a),m(t,s),c||(p=[V(e,"input",r[13]),V(s,"click",r[7])],c=!0)},p(_,u){u&2&&e.value!==_[1]&&R(e,_[1])},d(_){_&&v(t),r[12](null),c=!1,X(p)}}}function ot(r){let t,e;return{c(){t=w("div"),e=B(r[4]),this.h()},l(a){t=k(a,"DIV",{class:!0});var s=D(t);e=H(s,r[4]),s.forEach(v),this.h()},h(){i(t,"class","md:mt-10 text-center text-lg")},m(a,s){W(a,t,s),m(t,e)},p(a,s){s&16&&$(e,a[4])},d(a){a&&v(t)}}}function it(r){let t,e,a,s,g='<a href="/">Paste</a>',c,p,_,u,E,y,T,C,I,b,P,N,S,O,j;function A(l,h){return l[4]?ot:l[6]&&!l[2]?lt:nt}let o=A(r),d=o(r);return{c(){t=w("div"),e=w("div"),a=w("div"),s=w("h1"),s.innerHTML=g,c=L(),p=w("button"),_=B("Info"),E=L(),y=w("button"),T=B("New"),I=L(),b=w("button"),P=B("Save"),S=L(),d.c(),this.h()},l(l){t=k(l,"DIV",{class:!0});var h=D(t);e=k(h,"DIV",{class:!0});var n=D(e);a=k(n,"DIV",{class:!0});var f=D(a);s=k(f,"H1",{class:!0,"data-svelte-h":!0}),J(s)!=="svelte-12fojij"&&(s.innerHTML=g),c=U(f),p=k(f,"BUTTON",{class:!0,title:!0});var x=D(p);_=H(x,"Info"),x.forEach(v),E=U(f),y=k(f,"BUTTON",{class:!0,title:!0});var M=D(y);T=H(M,"New"),M.forEach(v),I=U(f),b=k(f,"BUTTON",{class:!0,title:!0});var z=D(b);P=H(z,"Save"),z.forEach(v),f.forEach(v),n.forEach(v),S=U(h),d.l(h),h.forEach(v),this.h()},h(){i(s,"class","mr-auto text-2xl"),i(p,"class","underline underline-offset-4 px-2 py-1"),i(p,"title",u=r[5]+"+I"),i(y,"class","underline underline-offset-4 px-2 py-1"),i(y,"title",C=r[5]+"+N"),i(b,"class","bg-amber-500 text-black text-lg px-4 py-1"),i(b,"title",N=r[5]+"+S"),i(a,"class","flex flex-row items-center gap-4"),i(e,"class","pb-4"),i(t,"class","p-2 min-h-screen w-screen flex flex-col text-primary")},m(l,h){W(l,t,h),m(t,e),m(e,a),m(a,s),m(a,c),m(a,p),m(p,_),m(a,E),m(a,y),m(y,T),m(a,I),m(a,b),m(b,P),m(t,S),d.m(t,null),O||(j=[V(p,"click",r[10]),V(y,"click",r[11]),V(b,"click",r[8])],O=!0)},p(l,[h]){h&32&&u!==(u=l[5]+"+I")&&i(p,"title",u),h&32&&C!==(C=l[5]+"+N")&&i(y,"title",C),h&32&&N!==(N=l[5]+"+S")&&i(b,"title",N),o===(o=A(l))&&d?d.p(l,h):(d.d(1),d=o(l),d&&(d.c(),d.m(t,null)))},i:q,o:q,d(l){l&&v(t),d.d(),O=!1,X(j)}}}function ct(r,t,e){let a;G(r,st,o=>e(15,a=o));let{data:s}=t,{isOwner:g,content:c,encrypted:p,passwordProtected:_,initVector:u}=s,E="",y=!1,T,C;g||(C="You are not the owner of this paste");let I="Ctrl";Q(()=>{var d,l,h;const o=((l=(d=navigator.userAgentData)==null?void 0:d.platform)==null?void 0:l.toLowerCase())==="macos"||((h=navigator.platform)==null?void 0:h.toLowerCase().startsWith("mac"));e(5,I=o?"âŒ˜":"Ctrl"),T==null||T.focus(),document.addEventListener("keydown",n=>{n.key==="s"&&(n.ctrlKey||n.metaKey)&&(n.preventDefault(),P()),n.key==="n"&&(n.ctrlKey||n.metaKey)&&(n.preventDefault(),K("/")),n.key==="i"&&(n.ctrlKey||n.metaKey)&&(n.preventDefault(),K("/info")),p&&_&&!y&&n.key==="Enter"&&(n.preventDefault(),b())}),p&&!_&&(async()=>{try{const n=a.url.hash.slice(1);if(!u||!n)throw new Error("Missing key");const{decrypt:f}=await F(()=>import("../chunks/crypto.VCyhLLHW.js"),[],import.meta.url);e(0,c=await f(c,u,decodeURIComponent(n)))}catch{e(4,C="Failed to decrypt")}finally{e(2,y=!0)}})()});async function b(){try{if(!u)throw new Error("Missing key");const{decryptWithPassword:o}=await F(()=>import("../chunks/crypto.VCyhLLHW.js"),[],import.meta.url);e(0,c=await o(c,u,E))}catch{e(4,C="Failed to decrypt")}finally{e(2,y=!0)}}async function P(){var n;if(!c)return;let o=c,d="",l;if(p)if(E){const{ciphertext:f,iv:x}=await rt(c,E);o=f,l=x}else{const f=a.url.hash.slice(1),{ciphertext:x,iv:M}=await at(c,decodeURIComponent(f));o=x,l=M,d=`#${f}`}const h={key:a.params.key,content:o,encrypted:p,initVector:l};try{const x=await(await fetch("/api/paste",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(h)})).json();x.success?await K(`/${(n=x.data)==null?void 0:n.key}${d}`):console.log(x)}catch(f){console.log(f)}}const N=()=>K("/info"),S=()=>K("/");function O(o){Z[o?"unshift":"push"](()=>{T=o,e(3,T)})}function j(){E=this.value,e(1,E)}function A(){c=this.value,e(0,c)}return r.$$set=o=>{"data"in o&&e(9,s=o.data)},[c,E,y,T,C,I,_,b,P,s,N,S,O,j,A]}class _t extends tt{constructor(t){super(),et(this,t,ct,it,Y,{data:9})}}export{_t as component};
