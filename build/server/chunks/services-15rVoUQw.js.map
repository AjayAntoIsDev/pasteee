{"version":3,"file":"services-15rVoUQw.js","sources":["../../../.svelte-kit/adapter-node/chunks/services.js"],"sourcesContent":["import { e as error } from \"./index.js\";\nimport { p as prisma } from \"./prisma.js\";\nasync function getPaste(key) {\n  let data = await prisma.paste.findUnique({\n    where: { key },\n    select: {\n      content: true,\n      encrypted: true,\n      passwordProtected: true,\n      initVector: true,\n      language: true,\n      expiresCount: true,\n      readCount: true,\n      ownerId: true\n    }\n  });\n  if (!data)\n    error(404, \"Not found\");\n  data = await prisma.paste.update({\n    where: { key },\n    data: { readCount: { increment: 1 } }\n  });\n  const { expiresCount, readCount } = data;\n  if (expiresCount !== null && expiresCount < readCount) {\n    await prisma.paste.delete({ where: { key } });\n    error(404, \"Not found\");\n  }\n  const {\n    content,\n    encrypted,\n    passwordProtected,\n    initVector,\n    language,\n    ownerId\n  } = data;\n  return {\n    key,\n    content,\n    encrypted,\n    passwordProtected,\n    initVector,\n    language,\n    ownerId\n  };\n}\nasync function deleteExpiredPastes() {\n  await prisma.paste.deleteMany({\n    where: {\n      expiresAt: {\n        lt: /* @__PURE__ */ new Date()\n      }\n    }\n  });\n}\nexport {\n  deleteExpiredPastes as d,\n  getPaste as g\n};\n"],"names":[],"mappings":";;;AAEA,eAAe,QAAQ,CAAC,GAAG,EAAE;AAC7B,EAAE,IAAI,IAAI,GAAG,MAAM,MAAM,CAAC,KAAK,CAAC,UAAU,CAAC;AAC3C,IAAI,KAAK,EAAE,EAAE,GAAG,EAAE;AAClB,IAAI,MAAM,EAAE;AACZ,MAAM,OAAO,EAAE,IAAI;AACnB,MAAM,SAAS,EAAE,IAAI;AACrB,MAAM,iBAAiB,EAAE,IAAI;AAC7B,MAAM,UAAU,EAAE,IAAI;AACtB,MAAM,QAAQ,EAAE,IAAI;AACpB,MAAM,YAAY,EAAE,IAAI;AACxB,MAAM,SAAS,EAAE,IAAI;AACrB,MAAM,OAAO,EAAE,IAAI;AACnB,KAAK;AACL,GAAG,CAAC,CAAC;AACL,EAAE,IAAI,CAAC,IAAI;AACX,IAAI,KAAK,CAAC,GAAG,EAAE,WAAW,CAAC,CAAC;AAC5B,EAAE,IAAI,GAAG,MAAM,MAAM,CAAC,KAAK,CAAC,MAAM,CAAC;AACnC,IAAI,KAAK,EAAE,EAAE,GAAG,EAAE;AAClB,IAAI,IAAI,EAAE,EAAE,SAAS,EAAE,EAAE,SAAS,EAAE,CAAC,EAAE,EAAE;AACzC,GAAG,CAAC,CAAC;AACL,EAAE,MAAM,EAAE,YAAY,EAAE,SAAS,EAAE,GAAG,IAAI,CAAC;AAC3C,EAAE,IAAI,YAAY,KAAK,IAAI,IAAI,YAAY,GAAG,SAAS,EAAE;AACzD,IAAI,MAAM,MAAM,CAAC,KAAK,CAAC,MAAM,CAAC,EAAE,KAAK,EAAE,EAAE,GAAG,EAAE,EAAE,CAAC,CAAC;AAClD,IAAI,KAAK,CAAC,GAAG,EAAE,WAAW,CAAC,CAAC;AAC5B,GAAG;AACH,EAAE,MAAM;AACR,IAAI,OAAO;AACX,IAAI,SAAS;AACb,IAAI,iBAAiB;AACrB,IAAI,UAAU;AACd,IAAI,QAAQ;AACZ,IAAI,OAAO;AACX,GAAG,GAAG,IAAI,CAAC;AACX,EAAE,OAAO;AACT,IAAI,GAAG;AACP,IAAI,OAAO;AACX,IAAI,SAAS;AACb,IAAI,iBAAiB;AACrB,IAAI,UAAU;AACd,IAAI,QAAQ;AACZ,IAAI,OAAO;AACX,GAAG,CAAC;AACJ,CAAC;AACD,eAAe,mBAAmB,GAAG;AACrC,EAAE,MAAM,MAAM,CAAC,KAAK,CAAC,UAAU,CAAC;AAChC,IAAI,KAAK,EAAE;AACX,MAAM,SAAS,EAAE;AACjB,QAAQ,EAAE,kBAAkB,IAAI,IAAI,EAAE;AACtC,OAAO;AACP,KAAK;AACL,GAAG,CAAC,CAAC;AACL;;;;"}